<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CGPA Calculator (Public, Session-Only)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        // --- Core Application Logic (No Firebase/Firestore/Auth) ---

        // Constants
        const TOTAL_PROGRAM_CREDITS = 162.0;

        // Global array to hold course data for the current session only
        let courses = [];
        let semesterGpaEntries = [];
        let isAppReady = false;
        let isEditMode = false;
        let editingCourseTimestamp = null;
        let editingGpaTimestamp = null;

        // Grade Map (Standard 10-point scale, 'F' is 0, P/F for non-GPA courses)
        const gradeMap = {
            'S': 10, 'A': 9, 'B': 8, 'C': 7, 'D': 6, 'E': 5, 'F': 0
        };

        // --- UI Visibility Handlers ---
        
        // Modal elements initialized globally for immediate access
        let modal, modalTitle, modalMessage, modalActions;
        let currentMode = 'course'; // 'course' or 'gpa'

        function showMainApp() {
            document.getElementById('main-container').classList.remove('hidden');
        }

        /**
         * Initializes the application by setting up the UI and loading/rendering initial data.
         */
        async function initializeApp() {
            // Initialize Modal DOM elements (Fix for TypeError: Cannot set properties of null)
            modal = document.getElementById('custom-modal');
            modalTitle = document.getElementById('modal-title');
            modalMessage = document.getElementById('modal-message');
            modalActions = document.getElementById('modal-actions');
            
            document.getElementById('app-status').textContent = 'Ready (Data is NOT saved, session-only)';
            isAppReady = true;
            showMainApp();
            
            // Set initial mode
            switchMode('course'); 
            
            // Render the initial empty state
            renderCourseTrackerUI(courses); 
            renderGpaTrackerUI(semesterGpaEntries);

            // Set initial credits input value
            document.getElementById('credits-input').value = '3.0';
        }
        
        // --- Mode Switching ---

        window.switchMode = function(mode) {
            currentMode = mode;

            const courseButton = document.getElementById('mode-course-btn');
            const gpaButton = document.getElementById('mode-gpa-btn');
            const courseContainer = document.getElementById('course-tracker-container');
            const gpaContainer = document.getElementById('gpa-tracker-container');
            const courseSummary = document.getElementById('course-summary-section');
            const gpaSummary = document.getElementById('gpa-summary-section');

            if (mode === 'course') {
                courseButton.classList.add('bg-indigo-600', 'text-white');
                courseButton.classList.remove('bg-white', 'text-gray-700');
                gpaButton.classList.add('bg-white', 'text-gray-700');
                gpaButton.classList.remove('bg-indigo-600', 'text-white');
                
                courseContainer.classList.remove('hidden');
                gpaContainer.classList.add('hidden');
                courseSummary.classList.remove('hidden');
                gpaSummary.classList.add('hidden');
                
                renderCourseTrackerUI(courses);
            } else {
                gpaButton.classList.add('bg-indigo-600', 'text-white');
                gpaButton.classList.remove('bg-white', 'text-gray-700');
                courseButton.classList.add('bg-white', 'text-gray-700');
                courseButton.classList.remove('bg-indigo-600', 'text-white');
                
                gpaContainer.classList.remove('hidden');
                courseContainer.classList.add('hidden');
                gpaSummary.classList.remove('hidden');
                courseSummary.classList.add('hidden');
                
                renderGpaTrackerUI(semesterGpaEntries);
            }
        }

        // --- Course-Wise CGPA Logic ---

        /**
         * Calculates GPA and CGPA from the list of courses.
         * @param {Array<Object>} courses - The list of course objects.
         */
        function calculateGrades(courses) {
            const semesterData = {};
            let gradedCredits = 0; // Only credits contributing to CGPA
            let cumulativeGradePoints = 0;
            let earnedCredits = 0; // Total credits earned (including non-GPA passes)

            courses.forEach(course => {
                const credits = course.credits;
                let gp = 0;
                let tgp = 0;
                let creditEarned = false;

                if (!course.isNonGpa) {
                    // 1. Graded Course (Contributes to GPA)
                    gp = gradeMap[course.grade] || 0;
                    tgp = credits * gp;

                    gradedCredits += credits;
                    cumulativeGradePoints += tgp;
                    
                    // Credits earned if grade is not 'F'
                    creditEarned = (course.grade !== 'F');

                } else {
                    // 2. Non-GPA Course (P/F Only)
                    if (course.grade === 'P') {
                        // Pass: Credits earned, but 0 GP contribution to CGPA
                        creditEarned = true;
                    } else if (course.grade === 'F') {
                        // Fail: No credits earned
                        creditEarned = false;
                    }
                    // Non-GPA courses never contribute to gradedCredits or cumulativeGradePoints
                }
                
                if (creditEarned) {
                    earnedCredits += credits;
                }


                // Semester-wise calculation for SGPA (only counts graded courses)
                // Note: semesterData[sem].totalCredits only tracks graded credits for SGPA calculation
                if (!semesterData[course.semester]) {
                    semesterData[course.semester] = { totalCredits: 0, totalGradePoints: 0, earnedCredits: 0, courses: [] };
                }
                
                if (!course.isNonGpa) {
                    semesterData[course.semester].totalCredits += credits;
                    semesterData[course.semester].totalGradePoints += tgp;
                }
                
                // Add course to semester breakdown list (regardless of GPA status)
                semesterData[course.semester].courses.push({ ...course, gradePoint: gp, totalGradePoints: tgp, creditEarned });
                if(creditEarned) {
                   semesterData[course.semester].earnedCredits += credits;
                }
            });

            // Calculate SGPA for each semester
            Object.keys(semesterData).forEach(sem => {
                const data = semesterData[sem];
                // SGPA only calculated if graded credits were added to totalCredits
                data.sgpa = data.totalCredits > 0 ? (data.totalGradePoints / data.totalCredits).toFixed(2) : 'N/A';
            });

            // Calculate CGPA
            const cgpa = gradedCredits > 0 ? (cumulativeGradePoints / gradedCredits).toFixed(2) : '0.00';
            const creditsLeft = Math.max(0, TOTAL_PROGRAM_CREDITS - earnedCredits);

            return { semesterData, cgpa, gradedCredits, cumulativeGradePoints, earnedCredits, creditsLeft };
        }

        /**
         * Renders the courses and GPA summary to the DOM from the local array.
         * @param {Array<Object>} courses - The local list of course objects.
         */
        function renderCourseTrackerUI(courses) {
            const { semesterData, cgpa, earnedCredits, creditsLeft } = calculateGrades(courses);
            
            // 1. Render CGPA Summary
            document.getElementById('cgpa-value').textContent = cgpa;
            document.getElementById('total-credits-value').textContent = earnedCredits.toFixed(1);
            document.getElementById('credits-left-value').textContent = creditsLeft.toFixed(1);

            // 2. Render Semester-wise breakdown (Credit Progress)
            const creditProgressContainer = document.getElementById('credit-progress-body');
            creditProgressContainer.innerHTML = '';
            
            let currentCumulativeCredits = 0;
            const sortedSemesters = Object.keys(semesterData).sort((a, b) => parseInt(a) - parseInt(b));

            sortedSemesters.forEach(sem => {
                const data = semesterData[sem];
                currentCumulativeCredits += data.earnedCredits;
                
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-2 font-medium">Semester ${sem}</td>
                    <td class="px-4 py-2 text-center">${data.earnedCredits.toFixed(1)}</td>
                    <td class="px-4 py-2 text-center">${currentCumulativeCredits.toFixed(1)}</td>
                `;
                creditProgressContainer.appendChild(row);
            });


            // 3. Render Course Breakdown (SGPA and Course List)
            const breakdownContainer = document.getElementById('course-breakdown-container');
            breakdownContainer.innerHTML = '';

            if (courses.length === 0) {
                 breakdownContainer.innerHTML = '<p class="text-gray-500 text-center py-8">Start adding courses to see your grades here.</p>';
                 return;
            }

            sortedSemesters.forEach(sem => {
                const semData = semesterData[sem];
                // Courses might be pushed out of order, sort them by timestamp for consistent display
                const semCourses = semData.courses.sort((a, b) => a.timestamp - b.timestamp); 

                const semElement = document.createElement('div');
                semElement.className = 'mb-6 p-4 bg-white/70 backdrop-blur-sm rounded-xl shadow-lg border border-gray-100';
                
                let courseRows = '';
                semCourses.forEach(course => {
                    const isExcluded = course.isNonGpa;
                    const rowClass = isExcluded ? 'bg-yellow-50 border-b border-yellow-100 hover:bg-yellow-100' : 'border-b border-gray-100 hover:bg-indigo-50';
                    const gradeText = isExcluded ? (course.grade === 'P' ? 'PASS' : 'FAIL') : `${course.grade} (${course.gradePoint})`;
                    const totalGPText = isExcluded ? 'â€”' : course.totalGradePoints.toFixed(1);
                    const creditsEarnedText = course.creditEarned ? '' : 'line-through text-red-500';

                    courseRows += `
                        <tr class="${rowClass} transition-colors" data-course-id="${course.timestamp}">
                            <td class="px-4 py-2 font-medium">${course.name}</td>
                            <td class="px-4 py-2 text-center ${creditsEarnedText}">${course.credits.toFixed(1)}</td>
                            <td class="px-4 py-2 text-center">${gradeText}</td>
                            <td class="px-4 py-2 text-center">${totalGPText}</td>
                            <td class="px-4 py-2 text-center flex justify-center space-x-2">
                                <button onclick="editCourse('${course.timestamp}')" class="text-indigo-600 hover:text-indigo-800 transition-colors p-1 rounded-full hover:bg-indigo-100 flex items-center text-sm font-medium">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 mr-1">
                                        <path d="M5.433 13.917V16.5a.5.5 0 0 0 .5.5H8.083a.5.5 0 0 0 .354-.146L18.454 6.708a1.5 1.5 0 0 0 0-2.122l-2.586-2.586a1.5 1.5 0 0 0-2.122 0L5.58 13.563a.5.5 0 0 0-.146.354Z" />
                                        <path fill-rule="evenodd" d="M16.92 18.08a.75.75 0 0 1-.72.67H3.75A2.25 2.25 0 0 1 1.5 16.5V4.375C1.5 3.339 2.345 2.5 3.375 2.5H6.25c.137 0 .26.046.362.125l3.25 2.5a.75.75 0 0 1 0 1.15L6.612 8.5A.75.75 0 0 1 5.375 8.5H3.75a.75.75 0 0 1 0-1.5h1.597l2.5-1.928a.75.75 0 0 1 .846 0l4.25 3.25c.102.079.225.125.362.125H16.5A2.25 2.25 0 0 1 18.75 10v6.125c0 1.036-.845 1.875-1.875 1.875Z" clip-rule="evenodd" />
                                    </svg>
                                    Edit
                                </button>
                                <button onclick="deleteCourse('${course.timestamp}')" class="text-red-500 hover:text-red-700 transition-colors p-1 rounded-full hover:bg-red-100 flex items-center text-sm font-medium">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 mr-1">
                                        <path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 0 0 6 3.75v.5H2.75a.75.75 0 0 0 0 1.5h.5v9.25c0 1.2.98 2.25 2.25 2.25h9.5c1.27 0 2.25-1.05 2.25-2.25V5.75h.5a.75.75 0 0 0 0-1.5H14v-.5A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 12a.75.75 0 0 1-.75-.75V8.5a.75.75 0 0 1 1.5 0v2.75a.75.75 0 0 1-.75.75Zm.75-6.75a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0ZM8.5 8.5a.75.75 0 0 0-1.5 0v2.75a.75.75 0 0 0 1.5 0v-2.75ZM13.25 8.5a.75.75 0 0 0-1.5 0v2.75a.75.75 0 0 0 1.5 0v-2.75Z" clip-rule="evenodd" />
                                    </svg>
                                    Delete
                                </button>
                            </td>
                        </tr>
                    `;
                });

                const sgpaDisplay = semData.sgpa !== 'N/A' ? `<span class="ml-4 text-indigo-600 bg-indigo-50 px-3 py-1 rounded-full text-lg shadow-sm">SGPA: ${semData.sgpa}</span>` : '';

                semElement.innerHTML = `
                    <h3 class="text-xl font-bold text-gray-800 mb-2 border-b pb-2 flex items-center">
                        Semester ${sem}
                        ${sgpaDisplay}
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead>
                                <tr class="bg-gray-50 text-gray-600 uppercase text-sm leading-normal">
                                    <th class="py-3 px-4 text-left">Course Name</th>
                                    <th class="py-3 px-4 text-center">Credits</th>
                                    <th class="py-3 px-4 text-center">Grade</th>
                                    <th class="py-3 px-4 text-center">Total GP</th>
                                    <th class="py-3 px-4 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-sm font-light">
                                ${courseRows}
                            </tbody>
                        </table>
                    </div>
                `;
                breakdownContainer.appendChild(semElement);
            });
            updateFormVisibility('course');
        }

        /**
         * Clears form and resets to Add Mode.
         */
        function resetCourseForm() {
            document.getElementById('course-name-input').value = '';
            document.getElementById('credits-input').value = '3.0';
            document.getElementById('is-non-gpa-input').checked = false;
            document.getElementById('graded-selector').value = 'S'; // FIXED: Use graded-selector
            
            // Ensure grade selectors are set correctly for default (graded mode)
            updateGradeSelectors(false);

            isEditMode = false;
            editingCourseTimestamp = null;
            document.getElementById('add-course-btn').textContent = 'Add Course & Calculate';
            document.getElementById('cancel-edit-btn').classList.add('hidden');
        }

        /**
         * Saves/Updates a course entry.
         */
        window.saveCourse = function() {
            if (!isAppReady) return;
            
            const semester = document.getElementById('semester-input').value;
            const courseName = document.getElementById('course-name-input').value.trim();
            const credits = parseFloat(document.getElementById('credits-input').value);
            const isNonGpa = document.getElementById('is-non-gpa-input').checked;
            let grade;

            if (isNonGpa) {
                grade = document.getElementById('non-gpa-selector').value; // FIXED: Use non-gpa-selector
            } else {
                grade = document.getElementById('graded-selector').value; // FIXED: Use graded-selector
            }


            // --- Validation ---
            if (!courseName || isNaN(credits) || credits <= 0) {
                showModal("Validation Error", "Please ensure Course Name is entered and Credits is a positive number.");
                return;
            }
            
            // Check for valid grade
            if (!isNonGpa && !gradeMap.hasOwnProperty(grade)) {
                showModal("Validation Error", `Grade '${grade}' is not a valid grade.`);
                return;
            }
            if (isNonGpa && (grade !== 'P' && grade !== 'F')) {
                 showModal("Validation Error", `For Non-GPA courses, please select either Pass (P) or Fail (F).`);
                 return;
            }
            
            // Check for duplicate names (only in Add Mode)
            const normalizedCourseName = courseName.toLowerCase();
            const isDuplicate = courses.some(course => {
                const isSameName = course.name.toLowerCase() === normalizedCourseName;
                // Allow same name if editing the course itself
                const isEditingSameCourse = isEditMode && course.timestamp === editingCourseTimestamp;
                return isSameName && !isEditingSameCourse;
            });

            if (!isEditMode && isDuplicate) {
                showModal("Validation Error", `A course named "${courseName}" already exists. Please edit the existing course or use a unique name.`);
                return;
            }
            // --- End Validation ---
            
            const newCourseData = {
                semester: parseInt(semester),
                name: courseName,
                credits: credits,
                grade: grade,
                isNonGpa: isNonGpa
            };

            if (isEditMode) {
                // UPDATE existing course
                const courseIndex = courses.findIndex(c => c.timestamp === editingCourseTimestamp);
                if (courseIndex !== -1) {
                    // Retain the original timestamp
                    courses[courseIndex] = { ...newCourseData, timestamp: editingCourseTimestamp };
                }
            } else {
                // ADD new course
                const newCourse = { ...newCourseData, timestamp: Date.now() };
                courses.push(newCourse);
            }

            // Re-render UI and reset form
            renderCourseTrackerUI(courses);
            resetCourseForm();
        }

        /**
         * Switches grade selector based on Non-GPA checkbox.
         */
        window.updateGradeSelectors = function(isNonGpa) {
            const gradedSelector = document.getElementById('graded-selector');
            const nonGpaSelector = document.getElementById('non-gpa-selector');

            if (!gradedSelector || !nonGpaSelector) {
                // Defensive check should not happen after the HTML ID fix
                console.error("Grade selectors not found in DOM.");
                return;
            }

            if (isNonGpa) {
                gradedSelector.classList.add('hidden');
                nonGpaSelector.classList.remove('hidden');
                nonGpaSelector.required = true; // FIXED: Use non-gpa-selector
                gradedSelector.required = false; // FIXED: Use graded-selector
            } else {
                gradedSelector.classList.remove('hidden');
                nonGpaSelector.classList.add('hidden');
                gradedSelector.required = true; // FIXED: Use graded-selector
                nonGpaSelector.required = false; // FIXED: Use non-gpa-selector
            }
        }

        /**
         * Enters edit mode for a specific course.
         */
        window.editCourse = function(timestamp) {
            const courseToEdit = courses.find(c => c.timestamp === parseInt(timestamp));
            if (!courseToEdit) return;

            // 1. Populate the form
            document.getElementById('semester-input').value = courseToEdit.semester;
            document.getElementById('course-name-input').value = courseToEdit.name;
            document.getElementById('credits-input').value = courseToEdit.credits;
            document.getElementById('is-non-gpa-input').checked = courseToEdit.isNonGpa;
            
            // Update the selector visibility
            updateGradeSelectors(courseToEdit.isNonGpa);

            if (courseToEdit.isNonGpa) {
                 document.getElementById('non-gpa-selector').value = courseToEdit.grade; // FIXED: Use non-gpa-selector
            } else {
                document.getElementById('graded-selector').value = courseToEdit.grade; // FIXED: Use graded-selector
            }

            // 2. Set Edit Mode state
            isEditMode = true;
            editingCourseTimestamp = parseInt(timestamp);

            // 3. Update button labels
            document.getElementById('add-course-btn').textContent = 'Save Changes';
            document.getElementById('cancel-edit-btn').classList.remove('hidden');
        }

        /**
         * Deletes a course from the local array and updates the UI.
         */
        window.deleteCourse = function(deleteTimestamp) {
            if (!isAppReady) return;
            
            confirmAction.show('Confirm Deletion', 'Are you sure you want to delete this course?', () => {
                const timestampToDelete = parseInt(deleteTimestamp);
                const initialLength = courses.length;

                // Filter the global courses array
                courses = courses.filter(course => course.timestamp !== timestampToDelete);

                if (courses.length < initialLength) {
                    renderCourseTrackerUI(courses);
                    resetCourseForm();
                } else {
                    showModal("Error", "Could not find the course to delete.");
                }
            });
        }
        
        // --- Semester-Wise CGPA Logic (Forecast) ---

        /**
         * Calculates final CGPA based on semester-wise SGPA entries.
         */
        function calculateGpaForecast(entries) {
            let gradedCredits = 0; // Total credits contributing to the forecast CGPA
            let totalGradePoints = 0;

            entries.forEach(entry => {
                // For the forecast, all entered credits are treated as graded and earned.
                gradedCredits += entry.credits;
                totalGradePoints += entry.sgpa * entry.credits;
            });

            // Calculate CGPA based only on the graded credits accounted for in the entries
            const cgpa = gradedCredits > 0 ? (totalGradePoints / gradedCredits).toFixed(2) : '0.00';
            
            // Credits left based on the difference between total program credits and graded credits entered
            const creditsLeft = Math.max(0, TOTAL_PROGRAM_CREDITS - gradedCredits);
            
            return { cgpa, gradedCredits, creditsLeft };
        }

        /**
         * Renders the SGPA entries and GPA summary.
         */
        function renderGpaTrackerUI(entries) {
            const { cgpa, gradedCredits, creditsLeft } = calculateGpaForecast(entries);

            // 1. Render CGPA Summary (using dedicated elements for this mode)
            document.getElementById('cgpa-forecast-value').textContent = cgpa;
            document.getElementById('total-credits-forecast-value').textContent = gradedCredits.toFixed(1); // Renamed variable to gradedCredits
            document.getElementById('credits-left-forecast-value').textContent = creditsLeft.toFixed(1);

            // 2. Render Entries
            const entriesContainer = document.getElementById('sgpa-entries-container');
            entriesContainer.innerHTML = '';

            const sortedEntries = entries.sort((a, b) => a.semester - b.semester);

            if (entries.length === 0) {
                 entriesContainer.innerHTML = '<p class="text-gray-500 text-center py-8">Start adding semester GPAs to see the forecast.</p>';
                 return;
            }

            sortedEntries.forEach(entry => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-100 hover:bg-indigo-50 transition-colors';
                row.innerHTML = `
                    <td class="px-4 py-2 font-medium">Semester ${entry.semester}</td>
                    <td class="px-4 py-2 text-center">${entry.sgpa.toFixed(2)}</td>
                    <td class="px-4 py-2 text-center">${entry.credits.toFixed(1)}</td>
                    <td class="px-4 py-2 text-center flex justify-center space-x-2">
                        <button onclick="editGpaEntry('${entry.timestamp}')" class="text-indigo-600 hover:text-indigo-800 transition-colors p-1 rounded-full hover:bg-indigo-100 flex items-center text-sm font-medium">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 mr-1">
                                <path d="M5.433 13.917V16.5a.5.5 0 0 0 .5.5H8.083a.5.5 0 0 0 .354-.146L18.454 6.708a1.5 1.5 0 0 0 0-2.122l-2.586-2.586a1.5 1.5 0 0 0-2.122 0L5.58 13.563a.5.5 0 0 0-.146.354Z" />
                                <path fill-rule="evenodd" d="M16.92 18.08a.75.75 0 0 1-.72.67H3.75A2.25 2.25 0 0 1 1.5 16.5V4.375C1.5 3.339 2.345 2.5 3.375 2.5H6.25c.137 0 .26.046.362.125l3.25 2.5a.75.75 0 0 1 0 1.15L6.612 8.5A.75.75 0 0 1 5.375 8.5H3.75a.75.75 0 0 1 0-1.5h1.597l2.5-1.928a.75.75 0 0 1 .846 0l4.25 3.25c.102.079.225.125.362.125H16.5A2.25 2.25 0 0 1 18.75 10v6.125c0 1.036-.845 1.875-1.875 1.875Z" clip-rule="evenodd" />
                            </svg>
                            Edit
                        </button>
                        <button onclick="deleteGpaEntry('${entry.timestamp}')" class="text-red-500 hover:text-red-700 transition-colors p-1 rounded-full hover:bg-red-100 flex items-center text-sm font-medium">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 mr-1">
                                <path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 0 0 6 3.75v.5H2.75a.75.75 0 0 0 0 1.5h.5v9.25c0 1.2.98 2.25 2.25 2.25h9.5c1.27 0 2.25-1.05 2.25-2.25V5.75h.5a.75.75 0 0 0 0-1.5H14v-.5A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 12a.75.75 0 0 1-.75-.75V8.5a.75.75 0 0 1 1.5 0v2.75a.75.75 0 0 1-.75.75Zm.75-6.75a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0ZM8.5 8.5a.75.75 0 0 0-1.5 0v2.75a.75.75 0 0 0 1.5 0v-2.75ZM13.25 8.5a.75.75 0 0 0-1.5 0v2.75a.75.75 0 0 0 1.5 0v-2.75Z" clip-rule="evenodd" />
                            </svg>
                            Delete
                        </button>
                    </td>
                </tr>
                `;
                entriesContainer.appendChild(row);
            });
            updateFormVisibility('gpa');
        }

        /**
         * Saves/Updates an SGPA entry.
         */
        window.saveGpaEntry = function() {
            if (!isAppReady) return;

            const semester = document.getElementById('gpa-semester-input').value;
            const sgpa = parseFloat(document.getElementById('sgpa-input').value);
            const credits = parseFloat(document.getElementById('gpa-credits-input').value);

            // --- Validation ---
            if (isNaN(sgpa) || sgpa < 0 || sgpa > 10 || isNaN(credits) || credits <= 0) {
                showModal("Validation Error", "Please ensure SGPA is between 0 and 10 and Credits is a positive number.");
                return;
            }
            
            // Check for duplicate semester (only in Add Mode)
            const isDuplicate = semesterGpaEntries.some(entry => {
                const isSameSemester = entry.semester === parseInt(semester);
                const isEditingSameEntry = isEditMode && entry.timestamp === editingGpaTimestamp;
                return isSameSemester && !isEditingSameEntry;
            });

            if (!isEditMode && isDuplicate) {
                showModal("Validation Error", `Semester ${semester} GPA entry already exists. Please edit the existing entry.`);
                return;
            }
            // --- End Validation ---

            const newEntryData = {
                semester: parseInt(semester),
                sgpa: sgpa,
                credits: credits,
            };

            if (isEditMode) {
                // UPDATE existing entry
                const entryIndex = semesterGpaEntries.findIndex(e => e.timestamp === editingGpaTimestamp);
                if (entryIndex !== -1) {
                    // Retain the original timestamp
                    semesterGpaEntries[entryIndex] = { ...newEntryData, timestamp: editingGpaTimestamp };
                }
            } else {
                // ADD new entry
                const newEntry = { ...newEntryData, timestamp: Date.now() };
                semesterGpaEntries.push(newEntry);
            }

            // Re-render UI and reset form
            renderGpaTrackerUI(semesterGpaEntries);
            resetGpaForm();
        }

        /**
         * Clears form and resets to Add Mode for GPA entries.
         */
        function resetGpaForm() {
            document.getElementById('sgpa-input').value = '';
            document.getElementById('gpa-credits-input').value = '';
            
            isEditMode = false;
            editingGpaTimestamp = null;
            document.getElementById('add-gpa-btn').textContent = 'Add Entry & Calculate Forecast';
            document.getElementById('cancel-gpa-edit-btn').classList.add('hidden');
        }

        /**
         * Enters edit mode for a specific GPA entry.
         */
        window.editGpaEntry = function(timestamp) {
            const entryToEdit = semesterGpaEntries.find(e => e.timestamp === parseInt(timestamp));
            if (!entryToEdit) return;

            // 1. Populate the form
            document.getElementById('gpa-semester-input').value = entryToEdit.semester;
            document.getElementById('sgpa-input').value = entryToEdit.sgpa;
            document.getElementById('gpa-credits-input').value = entryToEdit.credits;
            
            // 2. Set Edit Mode state
            isEditMode = true;
            editingGpaTimestamp = parseInt(timestamp);

            // 3. Update button labels
            document.getElementById('add-gpa-btn').textContent = 'Save Changes';
            document.getElementById('cancel-gpa-edit-btn').classList.remove('hidden');
        }

        /**
         * Deletes a GPA entry from the local array and updates the UI.
         */
        window.deleteGpaEntry = function(deleteTimestamp) {
            if (!isAppReady) return;
            
            confirmAction.show('Confirm Deletion', 'Are you sure you want to delete this semester GPA entry?', () => {
                const timestampToDelete = parseInt(deleteTimestamp);
                const initialLength = semesterGpaEntries.length;

                semesterGpaEntries = semesterGpaEntries.filter(entry => entry.timestamp !== timestampToDelete);

                if (semesterGpaEntries.length < initialLength) {
                    renderGpaTrackerUI(semesterGpaEntries);
                    resetGpaForm();
                } else {
                    showModal("Error", "Could not find the GPA entry to delete.");
                }
            });
        }

        /**
         * Updates the visibility of the Add/Edit form based on mode.
         */
        function updateFormVisibility(mode) {
            const courseForm = document.getElementById('course-form');
            const gpaForm = document.getElementById('gpa-form');
            if (mode === 'course') {
                courseForm.classList.remove('hidden');
                gpaForm.classList.add('hidden');
                resetGpaForm();
            } else {
                courseForm.classList.add('hidden');
                gpaForm.classList.remove('hidden');
                resetCourseForm();
            }
        }

        // --- Custom Modal and Confirmation Logic (No alert/confirm) ---

        function hideModal() {
            modal.classList.add('hidden');
        }

        window.showModal = function(title, message, confirmCallback = null) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalActions.innerHTML = '';

            const closeButton = document.createElement('button');
            closeButton.className = 'px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition-colors shadow-md';
            closeButton.textContent = 'Close';
            closeButton.onclick = hideModal;
            modalActions.appendChild(closeButton);

            if (confirmCallback) {
                const confirmButton = document.createElement('button');
                confirmButton.className = 'px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition-colors shadow-md ml-3';
                confirmButton.textContent = 'Confirm';
                confirmButton.onclick = () => {
                    hideModal();
                    confirmCallback();
                };
                modalActions.appendChild(confirmButton);
            }

            modal.classList.remove('hidden');
        }

        const confirmAction = {
            show: (title, message, callback) => {
                showModal(title, message, callback);
                return true;
            }
        };

        // --- Print Functionality (Uses browser Print-to-PDF) ---

        window.printReport = function() {
            const name = document.getElementById('student-name-input').value.trim();
            if (!name) {
                showModal("Input Required", "Please enter your name before generating the report.");
                return;
            }

            let reportContent = '';
            
            if (currentMode === 'course') {
                const { cgpa, earnedCredits, creditsLeft } = calculateGrades(courses);
                const courseBreakdownHtml = document.getElementById('course-breakdown-container').innerHTML;
                
                reportContent = `
                    <h2 class="text-2xl font-bold mb-4">CGPA Report (Course-Wise Tracker)</h2>
                    <div class="flex justify-between mb-6 border-b pb-4">
                        <div class="text-lg"><strong>Overall CGPA:</strong> <span class="text-indigo-600">${cgpa}</span></div>
                        <div class="text-lg"><strong>Credits Earned:</strong> ${earnedCredits.toFixed(1)}</div>
                        <div class="text-lg"><strong>Credits Left (Target 162):</strong> ${creditsLeft.toFixed(1)}</div>
                    </div>
                    ${courseBreakdownHtml}
                `;
            } else {
                const { cgpa, gradedCredits, creditsLeft } = calculateGpaForecast(semesterGpaEntries);

                reportContent = `
                    <h2 class="text-2xl font-bold mb-4">CGPA Forecast Report (Semester GPA Calculator)</h2>
                    <div class="flex justify-between mb-6 border-b pb-4">
                        <div class="text-lg"><strong>CGPA Forecast:</strong> <span class="text-indigo-600">${cgpa}</span></div>
                        <div class="text-lg"><strong>Total Graded Credits Accounted For:</strong> ${gradedCredits.toFixed(1)}</div>
                        <div class="text-lg"><strong>Credits Left (Target 162):</strong> ${creditsLeft.toFixed(1)}</div>
                    </div>
                    <h3 class="text-xl font-bold mb-3">Semester Entries</h3>
                    <table class="table min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr class="bg-gray-50 text-gray-600 uppercase text-sm leading-normal">
                                <th class="py-2 px-4 text-left">Semester</th>
                                <th class="py-2 px-4 text-center">SGPA</th>
                                <th class="py-2 px-4 text-center">Credits</th>
                            </tr>
                        </thead>
                        <tbody class="text-gray-700 text-sm font-light">
                            ${semesterGpaEntries.map(e => `
                                <tr>
                                    <td class="py-2 px-4">Semester ${e.semester}</td>
                                    <td class="py-2 px-4 text-center">${e.sgpa.toFixed(2)}</td>
                                    <td class="py-2 px-4 text-center">${e.credits.toFixed(1)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }


            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>CGPA Report</title>
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
                        body { font-family: 'Inter', sans-serif; margin: 20px; color: #1f2937; }
                        h1, h2, h3 { color: #111827; }
                        .header { border-bottom: 2px solid #3b82f6; padding-bottom: 15px; margin-bottom: 20px; }
                        .flex { display: flex; justify-content: space-between; }
                        .table { width: 100%; border-collapse: collapse; margin-top: 10px; }
                        .table th, .table td { border: 1px solid #e5e7eb; padding: 8px; text-align: left; }
                        .table th { background-color: #f3f4f6; text-transform: uppercase; font-size: 0.75rem; }
                        .table td.text-center { text-align: center; }
                        .bg-yellow-50 { background-color: #fefce8; }
                        .text-red-500 { color: #ef4444; }
                        .line-through { text-decoration: line-through; }
                        .text-indigo-600 { color: #4f46e5; }
                        @media print {
                            button { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1 style="font-size: 28px;">CGPA Academic Report</h1>
                        <p style="font-size: 16px;"><strong>Student Name:</strong> ${name}</p>
                        <p style="font-size: 16px;"><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
                        <p style="font-size: 16px;"><strong>Mode:</strong> ${currentMode === 'course' ? 'Course-Wise Tracker' : 'Semester GPA Calculator'}</p>
                    </div>
                    ${reportContent}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }

        // --- Initialization ---
        window.onload = initializeApp;
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
            min-height: 100vh;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #9ca3af;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #e5e7eb;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <!-- Modal Structure -->
    <div id="custom-modal" class="fixed inset-0 z-50 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-md transform transition-all">
            <h3 id="modal-title" class="text-xl font-bold text-gray-900 mb-3">Modal Title</h3>
            <p id="modal-message" class="text-gray-700 mb-6">Modal message goes here.</p>
            <div id="modal-actions" class="flex justify-end space-x-3">
                <!-- Buttons inserted by JS -->
            </div>
        </div>
    </div>

    <!-- Main Application Container -->
    <div id="main-container" class="max-w-7xl mx-auto hidden">
        
        <!-- Header, Name Input, and Print -->
        <header class="mb-8 p-6 bg-white rounded-2xl shadow-xl border-t-4 border-indigo-600">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 border-b pb-4">
                <!-- Changed H1 to include the session warning -->
                <h1 class="text-3xl font-extrabold text-gray-900 flex flex-col items-start mb-4 sm:mb-0">
                    <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8 mr-3 text-indigo-600">
                            <path d="M11.7 2.875A.75.75 0 0 1 12 3.75v16.5a.75.75 0 0 1-1.294.577l-2.486-2.302A.75.75 0 0 1 8 18h-1.5A2.25 2.25 0 0 1 4.25 15.75V8.25A2.25 2.25 0 0 1 6.5 6H8a.75.75 0 0 1 .706-.577l2.486-2.302Z" />
                            <path fill-rule="evenodd" d="M15.5 6.75a2.25 2.25 0 0 0-2.25 2.25v4.5c0 1.24.965 2.25 2.25 2.25s2.25-1.01 2.25-2.25V9a2.25 2.25 0 0 0-2.25-2.25Zm.16 3.864a.75.75 0 0 0-1.272-.731 28.537 28.537 0 0 1 1.272.73Z" clip-rule="evenodd" />
                        </svg>
                        CGPA Calculator
                    </div>
                    <!-- Session Warning Heading -->
                    <span class="text-xs text-red-500 font-semibold mt-1 bg-red-100 px-2 py-0.5 rounded-full">
                        SESSION ONLY: Refresh to switch modes (Data will be lost).
                    </span>
                </h1>
                <div class="flex items-center space-x-3 w-full sm:w-auto">
                    <input type="text" id="student-name-input" placeholder="Enter Your Full Name" class="p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 w-full sm:w-64">
                    <button onclick="printReport()" class="px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-colors shadow-md flex items-center whitespace-nowrap">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 mr-2">
                            <path fill-rule="evenodd" d="M5.5 3A2.5 2.5 0 0 0 3 5.5v2.75A2.75 2.75 0 0 0 5.75 11h8.5A2.75 2.75 0 0 0 17 8.25V5.5A2.5 2.5 0 0 0 14.5 3h-9ZM5.5 4a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v3A.5.5 0 0 1 14 8H6A.5.5 0 0 1 5.5 7.5v-3Z" clip-rule="evenodd" />
                            <path d="M5.75 11c-.34 0-.672.03-.996.09L3 17.25h14l-1.754-6.16c-.324-.06-.656-.09-.996-.09H5.75Z" />
                        </svg>
                        Print CGPA Report
                    </button>
                </div>
            </div>

            <!-- Mode Selector -->
            <div class="flex space-x-2 p-1 bg-gray-100 rounded-xl shadow-inner mb-6 w-full sm:w-fit mx-auto">
                <button id="mode-course-btn" onclick="switchMode('course')" class="px-5 py-2 rounded-lg text-sm font-semibold transition-colors flex-1 shadow-md">
                    Course-Wise Tracker
                </button>
                <button id="mode-gpa-btn" onclick="switchMode('gpa')" class="px-5 py-2 rounded-lg text-sm font-semibold transition-colors flex-1">
                    Semester GPA Calculator
                </button>
            </div>

            <!-- Summary Section for Course-Wise Mode -->
            <div id="course-summary-section">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <!-- CGPA Value -->
                    <div class="bg-indigo-500 text-white p-4 rounded-xl shadow-lg flex flex-col justify-center items-center">
                        <span class="text-4xl font-extrabold" id="cgpa-value">0.00</span>
                        <span class="text-sm font-medium opacity-80 mt-1">Overall CGPA</span>
                    </div>

                    <!-- Total Credits Earned -->
                    <div class="bg-indigo-100 text-indigo-800 p-4 rounded-xl shadow-lg flex flex-col justify-center items-center">
                        <span class="text-3xl font-extrabold" id="total-credits-value">0.0</span>
                        <span class="text-sm font-medium mt-1">Total Credits Earned</span>
                    </div>

                    <!-- Credits Left -->
                    <div class="bg-gray-50 border border-gray-200 text-gray-700 p-4 rounded-xl shadow-lg flex flex-col justify-center items-center">
                        <span class="text-3xl font-extrabold" id="credits-left-value">162.0</span>
                        <span class="text-sm font-medium mt-1">Credits Left (Target 162)</span>
                    </div>
                </div>

                <!-- Credit Progress Breakdown (Course-Wise) -->
                <div class="bg-gray-50 p-4 rounded-xl border border-gray-200 shadow-inner">
                    <h3 class="text-lg font-bold text-gray-800 mb-3 border-b pb-2">Credit Progress Breakdown</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead>
                                <tr class="bg-gray-100 text-gray-600 uppercase text-xs leading-normal">
                                    <th class="py-2 px-4 text-left">Semester</th>
                                    <th class="py-2 px-4 text-center">Credits Earned This Sem</th>
                                    <th class="py-2 px-4 text-center">Cumulative Earned Credits</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-sm font-light" id="credit-progress-body">
                                <!-- Credit rows inserted by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Summary Section for Semester GPA Mode -->
            <div id="gpa-summary-section" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <!-- CGPA Forecast Value -->
                    <div class="bg-blue-500 text-white p-4 rounded-xl shadow-lg flex flex-col justify-center items-center">
                        <span class="text-4xl font-extrabold" id="cgpa-forecast-value">0.00</span>
                        <span class="text-sm font-medium opacity-80 mt-1">CGPA Forecast</span>
                    </div>

                    <!-- Total Graded Credits Accounted For -->
                    <div class="bg-blue-100 text-blue-800 p-4 rounded-xl shadow-lg flex flex-col justify-center items-center">
                        <span class="text-3xl font-extrabold" id="total-credits-forecast-value">0.0</span>
                        <span class="text-sm font-medium mt-1">Total Graded Credits Accounted For</span>
                    </div>

                    <!-- Credits Left -->
                    <div class="bg-gray-50 border border-gray-200 text-gray-700 p-4 rounded-xl shadow-lg flex flex-col justify-center items-center">
                        <span class="text-3xl font-extrabold" id="credits-left-forecast-value">162.0</span>
                        <span class="text-sm font-medium mt-1">Credits Left (Target 162)</span>
                    </div>
                </div>
            </div>
            
            <p class="text-xs text-gray-500 mt-4"><span class="font-semibold" id="app-status"></span> | Standard Grading Scale: S=10, A=9, B=8, C=7, D=6, E=5, F=0</p>
        </header>

        <!-- Course-Wise Tracker Container -->
        <div id="course-tracker-container">
            <!-- Course Input Form -->
            <div class="bg-white p-6 rounded-2xl shadow-xl mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-4 border-b pb-2">Add/Edit Course Details</h2>
                <form onsubmit="event.preventDefault(); saveCourse();" id="course-form">
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                        <!-- Semester -->
                        <div>
                            <label for="semester-input" class="block text-sm font-medium text-gray-700">Semester</label>
                            <select id="semester-input" required class="mt-1 block w-full pl-3 pr-10 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                            </select>
                        </div>
                        
                        <!-- Course Name -->
                        <div class="col-span-2 md:col-span-1">
                            <label for="course-name-input" class="block text-sm font-medium text-gray-700">Course Name</label>
                            <input type="text" id="course-name-input" placeholder="e.g., Data Structures" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        </div>

                        <!-- Credits -->
                        <div>
                            <label for="credits-input" class="block text-sm font-medium text-gray-700">Credits</label>
                            <input type="number" step="0.5" min="0.5" id="credits-input" value="3.0" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        </div>

                        <!-- Grade Selector Group -->
                        <div class="col-span-2 md:col-span-1">
                            <label for="grade-input" class="block text-sm font-medium text-gray-700">Grade</label>
                            
                            <!-- Graded Selector (Default) -->
                            <select id="graded-selector" required class="mt-1 block w-full pl-3 pr-10 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                                <option value="S">S (10 GP)</option>
                                <option value="A">A (9 GP)</option>
                                <option value="B">B (8 GP)</option>
                                <option value="C">C (7 GP)</option>
                                <option value="D">D (6 GP)</option>
                                <option value="E">E (5 GP)</option>
                                <option value="F">F (0 GP - Fail)</option>
                            </select>

                            <!-- Non-GPA Selector (Hidden by default) -->
                            <select id="non-gpa-selector" class="mt-1 hidden w-full pl-3 pr-10 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-yellow-500 focus:border-yellow-500 shadow-sm">
                                <option value="P">P (Pass)</option>
                                <option value="F">F (Fail)</option>
                            </select>
                        </div>

                        <!-- Non-GPA Checkbox -->
                        <div class="col-span-2 md:col-span-1 flex items-end">
                            <div class="flex items-center">
                                <input type="checkbox" id="is-non-gpa-input" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" onchange="updateGradeSelectors(this.checked)">
                                <label for="is-non-gpa-input" class="ml-2 text-sm font-medium text-gray-700 whitespace-nowrap">Exclude from GPA</label>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button type="button" onclick="resetCourseForm()" id="cancel-edit-btn" class="hidden px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors shadow-sm">
                            Cancel Edit
                        </button>
                        <button type="submit" id="add-course-btn" class="px-6 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition-colors shadow-md text-sm">
                            Add Course & Calculate
                        </button>
                    </div>
                </form>
            </div>

            <!-- Course Breakdown -->
            <div id="course-breakdown-container">
                <!-- Semester breakdown divs inserted by JS -->
            </div>
        </div>

        <!-- Semester GPA Calculator Container -->
        <div id="gpa-tracker-container" class="hidden">
             <!-- SGPA Input Form -->
            <div class="bg-white p-6 rounded-2xl shadow-xl mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-4 border-b pb-2">Add/Edit Semester GPA Entry</h2>
                <form onsubmit="event.preventDefault(); saveGpaEntry();" id="gpa-form">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <!-- Semester -->
                        <div>
                            <label for="gpa-semester-input" class="block text-sm font-medium text-gray-700">Semester</label>
                            <select id="gpa-semester-input" required class="mt-1 block w-full pl-3 pr-10 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                            </select>
                        </div>
                        
                        <!-- SGPA -->
                        <div>
                            <label for="sgpa-input" class="block text-sm font-medium text-gray-700">SGPA (0.00 - 10.00)</label>
                            <input type="number" step="0.01" min="0" max="10" id="sgpa-input" placeholder="e.g., 9.25" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        </div>

                        <!-- Credits -->
                        <div>
                            <label for="gpa-credits-input" class="block text-sm font-medium text-gray-700">Total Graded Credits for Semester</label>
                            <input type="number" step="0.5" min="0.5" id="gpa-credits-input" placeholder="e.g., 20.0" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button type="button" onclick="resetGpaForm()" id="cancel-gpa-edit-btn" class="hidden px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors shadow-sm">
                            Cancel Edit
                        </button>
                        <button type="submit" id="add-gpa-btn" class="px-6 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition-colors shadow-md text-sm">
                            Add Entry & Calculate Forecast
                        </button>
                    </div>
                </form>
            </div>

            <!-- SGPA Entries Breakdown -->
            <div class="bg-white p-6 rounded-2xl shadow-xl">
                <h3 class="text-xl font-bold text-gray-900 mb-4 border-b pb-2">Semester GPA Entries</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr class="bg-gray-50 text-gray-600 uppercase text-sm leading-normal">
                                <th class="py-3 px-4 text-left">Semester</th>
                                <th class="py-3 px-4 text-center">SGPA</th>
                                <th class="py-3 px-4 text-center">Credits</th>
                                <th class="py-3 px-4 text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="text-gray-600 text-sm font-light" id="sgpa-entries-container">
                            <!-- Entries inserted by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
